# Quick QC function (basic cutting of cells).


 quickQC <- function(x, umi=c(1000,40000), genes=400, mito=15, ribo=30, plot=T) {
 
  # quickly make a library of reference gene names for Mitochondrial and Ribosomal genes
    mito.genes = c(
      "MT-ND1",  "MT-ND2",  "MT-CO1", "MT-CO2",  "MT-ATP8", "MT-ATP6", "MT-CO3", 
      "MT-ND3",  "MT-ND4L", "MT-ND4", "MT-ND5",  "MT-ND6",  "MT-CYB",
      "ENSG00000198888", "ENSG00000198763", "ENSG00000198804", "ENSG00000198712",
      "ENSG00000228253", "ENSG00000198899", "ENSG00000198938", "ENSG00000198840",
      "ENSG00000212907", "ENSG00000198886", "ENSG00000198786", "ENSG00000198695",
      "ENSG00000198727"
    )
    ribo.genes = c(
      "RPL22", "RPL11", "RPS6KA1", "RPS8", "RPL5",     
      "RPS27", "RPS6KC1", "RPS7", "RPS27A", "RPL31",      
      "RPL37A", "RPL32", "RPL15", "RPSA", "RPL14",      
      "RPL29", "RPL24", "RPL22L1", "RPL39L", "RPL35A",     
      "RPL9", "RPL34-AS1", "RPL34", "RPS3A", "RPL37",      
      "RPS23", "RPS14", "RPL26L1", "RPS18", "RPS10-NUDT3",
      "RPS10", "RPL10A", "RPL7L1", "RPS12", "RPS6KA2",    
      "RPS6KA2-IT1", "RPS6KA2-AS1", "RPS20", "RPL7", "RPL30",      
      "RPL8", "RPS6", "RPL35", "RPL12", "RPL7A",      
      "RPS24", "RPLP2", "RPL27A", "RPS13", "RPS6KA4",    
      "RPS6KB2", "RPS6KB2-AS1", "RPS3", "RPS25", "RPS26",      
      "RPL41", "RPL6", "RPLP0", "RPL21", "RPL10L",     
      "RPS29", "RPL36AL", "RPS6KL1", "RPS6KA5", "RPS27L",     
      "RPL4", "RPLP1", "RPS17", "RPL3L", "RPS2",       
      "RPS15A", "RPL13", "RPL26", "RPL23A", "RPL23",      
      "RPL19", "RPL27", "RPS6KB1", "RPL38", "RPL17",      
      "RPS15", "RPL36", "RPS28", "RPL18A", "RPS16",      
      "RPS19", "RPL18", "RPL13A", "RPS11", "RPS9",       
      "RPL28", "RPS5", "RPS21", "RPL3", "RPS19BP1",   
      "RPS6KA3", "RPS4X", "RPS6KA6", "RPL36A", "RPL39",      
      "RPL10", "RPS4Y1", "RPS4Y2",
      "ENSG00000116251", "ENSG00000142676", "ENSG00000117676", "ENSG00000142937",
      "ENSG00000122406", "ENSG00000177954", "ENSG00000136643", "ENSG00000171863",
      "ENSG00000143947", "ENSG00000071082", "ENSG00000197756", "ENSG00000144713",
      "ENSG00000174748", "ENSG00000168028", "ENSG00000188846", "ENSG00000162244",
      "ENSG00000114391", "ENSG00000163584", "ENSG00000163923", "ENSG00000182899",
      "ENSG00000163682", "ENSG00000234492", "ENSG00000109475", "ENSG00000145425",
      "ENSG00000145592", "ENSG00000186468", "ENSG00000164587", "ENSG00000037241",
      "ENSG00000231500", "ENSG00000270800", "ENSG00000124614", "ENSG00000198755",
      "ENSG00000146223", "ENSG00000112306", "ENSG00000071242", "ENSG00000232082",
      "ENSG00000231654", "ENSG00000008988", "ENSG00000147604", "ENSG00000156482",
      "ENSG00000161016", "ENSG00000137154", "ENSG00000136942", "ENSG00000197958",
      "ENSG00000148303", "ENSG00000138326", "ENSG00000177600", "ENSG00000166441",
      "ENSG00000110700", "ENSG00000162302", "ENSG00000175634", "ENSG00000255949",
      "ENSG00000149273", "ENSG00000118181", "ENSG00000197728", "ENSG00000229117",
      "ENSG00000089009", "ENSG00000089157", "ENSG00000122026", "ENSG00000165496",
      "ENSG00000213741", "ENSG00000165502", "ENSG00000198208", "ENSG00000100784",
      "ENSG00000185088", "ENSG00000174444", "ENSG00000137818", "ENSG00000182774",
      "ENSG00000140986", "ENSG00000140988", "ENSG00000134419", "ENSG00000167526",
      "ENSG00000161970", "ENSG00000198242", "ENSG00000125691", "ENSG00000108298",
      "ENSG00000131469", "ENSG00000108443", "ENSG00000172809", "ENSG00000265681",
      "ENSG00000115268", "ENSG00000130255", "ENSG00000233927", "ENSG00000105640",
      "ENSG00000105193", "ENSG00000105372", "ENSG00000063177", "ENSG00000142541",
      "ENSG00000142534", "ENSG00000170889", "ENSG00000108107", "ENSG00000083845",
      "ENSG00000171858", "ENSG00000100316", "ENSG00000187051", "ENSG00000177189",
      "ENSG00000198034", "ENSG00000072133", "ENSG00000241343", "ENSG00000198918",
      "ENSG00000147403", "ENSG00000129824", "ENSG00000280969"
    )

  # calculate parameters
    n.umi = colSums(x)
    n.genes = colSums(x > 0)
    n.mito = (colSums(x[rownames(x) %in% mito.genes,]) / n.umi) * 100
    n.ribo = (colSums(x[rownames(x) %in% ribo.genes,]) / n.umi) * 100
    
    qcm = cbind(n.umi, n.genes, n.mito, n.ribo)

  # subset cells, return cell names object:
    boolean = n.umi >= umi[1] & n.umi < umi[2] & n.genes >= genes & n.mito <= mito & n.ribo <= ribo
    cells2keep   = colnames(x)[boolean]

    if(plot == T){
      plot.dark()
      pairs(qcm, col=c("red", "white")[boolean+1], pch=".", cex=2)
    }
    
  #  pairs(n.umi, n.genes)
    
    return(cells2keep)

    
  }
  
